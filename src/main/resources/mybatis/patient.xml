<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.sportsdata.webapp.youth.dao.hospital.PatientDAO">
    
    <select id="getMedicalRecordList" resultType="cn.sportsdata.webapp.youth.common.bo.hospital.PatientRecordBO" parameterType="java.util.Map">
    	select A.id as recordId, D.real_name as patientName,
    		A.VISIT_DATE as startTime, D.gender as gender
	    	from medical_record A
	       	left join patient D on D.patient_number = A.PATIENT_ID and D.hospital_id = #{hospital_id}
	       	where A.DOCTOR_NO=#{doctor_code} and A.hospital_id=#{hospital_id} 
	       	and A.status = 'active' and to_days(VISIT_DATE) = to_days(now())
	       	order by VISIT_DATE desc, VISIT_NO
    </select>
    
    <select id="getMedicalRecord" resultType="cn.sportsdata.webapp.youth.common.bo.hospital.PatientMedicalRecordBO" parameterType="java.util.Map">
		select A.* from medical_record A 
			where A.record_id=#{recordId} and A.status = 'active'
    </select>
    
    <select id="getOperationRecord" resultType="cn.sportsdata.webapp.youth.common.bo.hospital.PatientOperationRecordBO" parameterType="java.util.Map">

    </select>
    
    <select id="getResidentRecord" resultType="cn.sportsdata.webapp.youth.common.bo.hospital.PatientResidentRecordBO" parameterType="java.util.Map">

    </select>
    
    <select id="getRecordAssetList" resultType="cn.sportsdata.webapp.youth.common.vo.patient.RecordAssetVO" parameterType="java.util.Map">
		select A.record_asset_type_id as asset_type_id, B.*, C.name as asset_type_name from hospital_record_asset A 
		join asset B on B.id = A.asset_id 
		join record_asset_type C on C.id = A.record_asset_type_id
		where A.hospital_record_id=#{record_id} and A.status = 'active' order by A.created_time desc
    </select>
    
    <select id="getRecordAssetTypeList" resultType="cn.sportsdata.webapp.youth.common.vo.patient.RecordAssetTypeVO" parameterType="java.util.Map">
		select A.id, A.name, A.record_type as recordType from record_asset_type A 
		where A.record_type=#{record_type} and A.status = 'active' order by A.id asc
    </select>
    
    <insert id="insertRecordAsset" parameterType="java.util.Map">
		insert into hospital_record_asset (id, hospital_id, hospital_record_id, asset_id, medical_data_type_id) 
		values(uuid(),  #{hospital_id},  #{hospital_record_id},  #{asset_id},  #{medical_data_type_id})
    </insert>
    
    <select id="getDoctorInfoByUsername" resultType="cn.sportsdata.webapp.youth.common.vo.patient.DoctorVO" parameterType="java.util.Map">
		select A.* from doctor A 
		left join user B on B.id = A.login_user_id
		where B.user_name=#{username} and A.status = 'active' order by A.id asc
    </select>
</mapper>

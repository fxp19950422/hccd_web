<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.sportsdata.webapp.youth.dao.hospital.PatientDAO">

    <select id="getRegisteRecordList" resultType="cn.sportsdata.webapp.youth.common.vo.patient.PatientRegistRecord" parameterType="java.util.Map">
    	select A.* from patient_regist A
	       	where A.doctor=#{doctor_code} and A.hospital_id=#{hospital_id} 
	       	and A.status = 'active' and to_days(VISIT_DATE) = to_days(STR_TO_DATE(#{date},"%Y-%m-%d"))
	       	order by VISIT_DATE desc, VISIT_NO
    </select>
    
    <select id="getMedicalRecordList" resultType="cn.sportsdata.webapp.youth.common.vo.patient.MedicalRecordVO" parameterType="java.util.Map">
    	select A.* from medical_record A
	       	where A.DOCTOR_NO=#{doctor_code} and A.hospital_id=#{hospital_id} 
	       	and A.status = 'active' and to_days(VISIT_DATE) = to_days(STR_TO_DATE(#{date},"%Y-%m-%d"))
	       	order by VISIT_DATE desc, VISIT_NO
    </select>
    
    <select id="getMyOperationRecordList" resultType="cn.sportsdata.webapp.youth.common.vo.patient.OpertaionRecord" parameterType="java.util.Map">
        select A.* from operation A
	       	where (A.OPERATOR=#{doctor_code} or A.OPERATOR=#{doctor_name}) and A.hospital_id=#{hospital_id} 
	       	and A.status = 'active' order by OPERATING_DATE desc
    </select>
    
    <select id="getFirstAsistOperationRecordList" resultType="cn.sportsdata.webapp.youth.common.vo.patient.OpertaionRecord" parameterType="java.util.Map">
        select A.* from operation A
	       	where A.FIRST_ASSISTANT=#{doctor_name} and A.hospital_id=#{hospital_id} 
	       	and A.status = 'active' order by OPERATING_DATE desc
    </select>
    
    <select id="getSecondAsistOperationRecordList" resultType="cn.sportsdata.webapp.youth.common.vo.patient.OpertaionRecord" parameterType="java.util.Map">
        select A.* from operation A
	       	where A.SECOND_ASSISTANT=#{doctor_name} and A.hospital_id=#{hospital_id} 
	       	and A.status = 'active' order by OPERATING_DATE desc
    </select>
    
    <select id="getAnesthesiaOperationRecordList" resultType="cn.sportsdata.webapp.youth.common.vo.patient.OpertaionRecord" parameterType="java.util.Map">
        select A.* from operation A
	       	where A.ANESTHESIA_DOCTOR=#{doctor_name} and A.hospital_id=#{hospital_id} 
	       	and A.status = 'active' order by OPERATING_DATE desc
    </select>
    
    <select id="getMyResidentRecordList" resultType="cn.sportsdata.webapp.youth.common.vo.patient.ResidentRecord" parameterType="java.util.Map">
        select A.* from resident_record A
	       	where A.doctor_id=#{doctor_code} and A.hospital_id=#{hospital_id} 
	       	and A.status = 'active' order by ADMISSION_DATE desc
    </select>
    
    <select id="getDirectResidentRecordList" resultType="cn.sportsdata.webapp.youth.common.vo.patient.ResidentRecord" parameterType="java.util.Map">
        select A.* from resident_record A
	       	where A.DIRECTOR=#{doctor_name} and A.hospital_id=#{hospital_id} 
	       	and A.status = 'active' order by ADMISSION_DATE desc
    </select>
    
    <select id="getAttendingResidentRecordList" resultType="cn.sportsdata.webapp.youth.common.vo.patient.ResidentRecord" parameterType="java.util.Map">
        select A.* from resident_record A
	       	where A.ATTENDING_DOCTOR=#{doctor_name} and A.hospital_id=#{hospital_id} 
	       	and A.status = 'active' order by ADMISSION_DATE desc
    </select>
        
    <select id="getRecordAssetList" resultType="cn.sportsdata.webapp.youth.common.vo.patient.RecordAssetVO" parameterType="java.util.Map">
		select A.record_asset_type_id as asset_type_id, B.*, C.name as asset_type_name from hospital_record_asset A 
		join asset B on B.id = A.asset_id 
		join record_asset_type C on C.id = A.record_asset_type_id
		where A.hospital_record_id=#{record_id} and A.status = 'active' order by A.created_time desc
    </select>
    
    <select id="getRecordAssetTypeList" resultType="cn.sportsdata.webapp.youth.common.vo.patient.RecordAssetTypeVO" parameterType="java.util.Map">
		select A.id, A.name, A.record_type as recordType from record_asset_type A 
		where A.record_type=#{record_type} and A.status = 'active' order by A.id asc
    </select>
    
    <insert id="insertRecordAsset" parameterType="java.util.Map">
		insert into hospital_record_asset (id, hospital_id, hospital_record_id, asset_id, medical_data_type_id) 
		values(uuid(),  #{hospital_id},  #{hospital_record_id},  #{asset_id},  #{medical_data_type_id})
    </insert>
    
    <select id="getDoctorInfoByUsername" resultType="cn.sportsdata.webapp.youth.common.vo.patient.DoctorVO" parameterType="java.util.Map">
		select A.* from doctor A 
		left join user B on B.id = A.login_user_id
		where B.user_name=#{username} and A.status = 'active' order by A.id asc
    </select>
    
 	<select id="getPatients" parameterType="java.util.List" resultType="cn.sportsdata.webapp.youth.common.vo.patient.PatientInfoVO">
        select * from patient where patient_number in
        <foreach collection="patientIdList" item="employeeId" index="index"
            open="(" close=")" separator=",">
            #{employeeId}
        </foreach>
    </select>
</mapper>
